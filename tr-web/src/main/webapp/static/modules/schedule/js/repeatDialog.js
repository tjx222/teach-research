define("cal/repeatDialog",["require","jquery","zxui/Calendar","common/dateFormat"],function(require){var e=require("jquery"),t=require("zxui/Calendar"),i=require("common/dateFormat"),n={data:null,init:function(e){this.resetDialog(e),this.repeatUnitChange(),this.repeatRateChange(),this.weeklyChecked(),this.monthlyChecked(),this.deadlineChange(),this.cancelRepeat(),this.closeDialog(),this.submitRepeat()},repeatUnitChange:function(){var t=this;e("#repeat-unit").change(function(){var i=e(this).closest(".repeat-dialog-content");t.data.unitValue=e(this).val(),i.get(0).className="repeat-dialog-content",i.addClass(e(this).val()),e("#unit").html(o[e(this).val()]),t.setAbstract()})},repeatRateChange:function(){var t=this;e("#repeat-rate").change(function(){t.data.rate=+e(this).children("option:selected").val(),t.setAbstract()})},weeklyChecked:function(){var t=this;e("#weekly input[type=checkbox]").change(function(){var i=e(this).val();if(t.removeArrayEle(t.data.dataObj.weekly,+i),e(this)[0].checked)t.data.dataObj.weekly.push(+i);t.setAbstract()})},monthlyChecked:function(){var t=this,i={};i.dayNum=e("#select-day-num"),i.weekRank=e("#select-week-rank"),i.weekDay=e("#select-week-day"),e("#monthly input[name=monthly]").change(function(){t.data.dataObj.monthly=e(this).val(),t.monthlyViewControl(e(this).val()),t.setAbstract()}),i.dayNum.on("change",function(){t.data.dataObj.dayNum=+e(this).val(),t.setAbstract()}),i.weekRank.on("change",function(){t.data.dataObj.weekRank=+e(this).val(),t.setAbstract()}),i.weekDay.on("change",function(){t.data.dataObj.weekDay=+e(this).val(),t.setAbstract()})},deadlineChange:function(){var n=this;e("#repeat input[name=deadline]").change(function(){var t=e(this).val();n.data.deadline=t,n.deadlineViewControl(t),n.setAbstract()}),e("#times").on("keyup",function(){var t=+e(this).val();if(!isNaN(t)&&t>0)if(t>999)n.data.deadlineTime=999;else n.data.deadlineTime=Math.floor(t);n.setAbstract()}).on("change",function(){e(this).val(n.data.deadlineTime)}),e("#aftertime").on("change",function(){var t=e(this).val();if(!i.isDateFormat(t))e(this).val(n.data.deadlineDate);else n.data.deadlineDate=t;n.setAbstract()}),new t({monthes:1,prefix:"ecl-ui-cal",dateFormat:"yyyy-MM-dd",triggers:e("#aftertime")[0],target:e("#aftertime")[0],value:"aftertime",onPick:function(){var e=this.target;n.data.deadlineDate=e.value,n.setAbstract()}}).render()},setAbstract:function(){var t=this,i="";if(1===+t.data.rate)i+="每"+o[t.data.unitValue];else i+="每 "+t.data.rate+" "+o[t.data.unitValue];switch(t.data.unitValue){case"week":var n=t.data.dataObj.weekly;if(n.sort(),7===n.length)i+=" 每天";else for(var s in n)i+=" 星期"+r[n[s]];break;case"month":if(1!==+t.data.rate)i="每 "+t.data.rate+" 个月";var l=t.data.dataObj.monthly;if(1===+l)i+=" "+t.data.dataObj.dayNum+"号";else if(2===+l)i+=" "+a[+t.data.dataObj.weekRank]+"的星期"+r[+t.data.dataObj.weekDay];break;case"year":var h=e("#list-item-start-time").val();h=h.split("-"),i+=" "+h[1]+"月"+h[2]+"日"}1===+t.data.deadline?i+=" 共执行"+t.data.deadlineTime+"次":2===+t.data.deadline&&(i+=" 直到"+t.data.deadlineDate+"结束"),e("#abstract").html(i)},getAbstract:function(){return e("#abstract").html()},setData:function(t){this.data=e.extend(!0,{},t)},getData:function(){return this.data},resetDialog:function(t){var i=this;i.setData(t),e("#repeat-content")[0].className="repeat-dialog-content "+i.data.unitValue,e("#repeat-unit option[value="+i.data.unitValue+"]")[0].selected=!0,e("#repeat-rate option[value="+i.data.rate+"]")[0].selected=!0,e("#unit").html(o[i.data.unitValue]),e("#weekly input[type=checkbox]").each(function(){e(this)[0].checked=!1});var n=i.data.dataObj.weekly;for(var r in n)e("#weekly input[type=checkbox][value="+n[r]+"]")[0].checked=!0;e("#monthly input[name=monthly]").each(function(e,t){t.value==i.data.dataObj.monthly&&(t.checked=!0)&&i.monthlyViewControl(t.value)}),e("#repeat input[name=deadline]").each(function(e,t){var n=t.value;if(+n===+i.data.deadline)t.checked=!0,i.deadlineViewControl(n)}),i.setAbstract()},submitRepeat:function(){},cancelRepeat:function(){e("#repeat-cancel").on("click",function(){e("#repeat").removeClass("current"),!e("#repeat-abstract").html()&&e("#repeat .list-item-ctx-checkbox").removeClass("current")})},closeDialog:function(){e(".repeat-dialog-title-close").on("click",function(){e("#repeat").removeClass("current"),!e("#repeat-abstract").html()&&e("#repeat .list-item-ctx-checkbox").removeClass("current")})},removeArrayEle:function(e,t){for(var i in e)if(e[i]===t)return e.splice(i,1),!0;return!1},deadlineViewControl:function(t){var i=this,n={};if(n.aftertime=e("#aftertime"),n.times=e("#times"),1===+t)n.aftertime.attr("disabled","disabled").val(""),n.times.removeAttr("disabled").val(i.data.deadlineTime);else if(2===+t)n.aftertime.removeAttr("disabled").val(i.data.deadlineDate),n.times.attr("disabled","disabled").val("");else n.times.attr("disabled","disabled").val(""),n.aftertime.attr("disabled","disabled").val("")},monthlyViewControl:function(t){var i=this,n={};if(n.dayNum=e("#select-day-num"),n.weekRank=e("#select-week-rank"),n.weekDay=e("#select-week-day"),1===+t)n.dayNum.removeAttr("disabled").val(i.data.dataObj.dayNum),n.weekRank.attr("disabled","disabled").val(1),n.weekDay.attr("disabled","disabled").val(1);else n.dayNum.attr("disabled","disabled").val(1),n.weekRank.removeAttr("disabled").val(i.data.dataObj.weekRank),n.weekDay.removeAttr("disabled").val(i.data.dataObj.weekDay)}},r={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",0:"日"},a={1:"第一周",2:"第二周",3:"第三周",4:"第四周",5:"最后一周"},o={day:"天",week:"周",month:"月",year:"年"};return n});