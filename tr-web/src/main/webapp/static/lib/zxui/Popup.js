define("zxui/Popup",["require","./lib","./Control"],function(require){var e=require("./lib"),t=require("./Control"),i=e.dom,n=e.page,r=t.extend({type:"Popup",options:{disabled:!1,main:"",target:"",triggers:"",liveTriggers:"",content:"",dir:"bl",prefix:"ecl-hotel-ui-popup",offset:{x:0,y:0}},binds:"onResize, onShow, onHide",init:function(t){if(this.disabled=t.disabled,this.content=t.content,t.target)this.target=e.g(t.target);var i=t.prefix,n=this.main=t.main&&e.g(t.main)||document.createElement("div");if(t.main)e.addClass(n,i);else n.className=i,n.style.left="-2000px";var r=this,o=t.triggers,a=t.liveTriggers;if(a)this.liveTriggers=e.on(e.g(a),"click",r.onShow);else{if(e.isString(o))o=e.q(t.triggers);e.each(e.toArray(o),function(t){e.on(t,"click",r.onShow)}),this.triggers=o}},render:function(){var t=this.main;if(!this.rendered){this.rendered=!0,!this.options.main&&document.body.appendChild(t);var i=this;e.on(t,"click",function(e){i.fire("click",{event:e})})}if(this.content)t.innerHTML=this.content;return this},onResize:function(){clearTimeout(this.resizeTimer);var e=this;this.resizeTimer=setTimeout(function(){e.show()},100)},onShow:function(t){var i=this.target;if(!this.disabled){if(i!==this.target)this.hide();var n=this,r=e.getTarget(t),o=this.liveTriggers;if(o){for(var a=this.options.triggers,s=e.hasClass;!s(r,a)&&r!==o;)r=r.parentNode;if(!s(r,a))return}this.fire("beforeShow",{event:t}),this.show(),this.trigger=r,this.timer=setTimeout(function(){e.on(document,"click",n.onHide),e.on(window,"resize",n.onResize)},0)}},onHide:function(t){var n=e.getTarget(t),r=this.main;if(r!==n&&!i.contains(r,n))this.hide(),clearTimeout(this.resizeTimer)},show:function(){this.computePosition(),this.fire("show")},hide:function(){this.main.style.left="-2000px",this.fire("hide"),e.un(document,"click",this.onHide),e.un(window,"resize",this.onResize),clearTimeout(this.timer),clearTimeout(this.resizeTimer)},computePosition:function(){var e=this.options,t=this.target||this.triggers[0],r=this.main,o=e.dir,a=i.getPosition(t),s=a.top,l=a.left,h=t.offsetWidth,u=t.offsetHeight,c=l+h,f=s+u,d=l+h/2,p=s+u/2,g=r.offsetWidth,m=r.offsetHeight,y=n.getScrollTop(),v=n.getScrollLeft(),b=v+n.getViewWidth(),_=y+n.getViewHeight(),x=t.getAttribute("data-popup");if(x)o=/[trbl]{2}/.test(x)?x:"1";var w,S;if("auto"===o){var T=h>g||l-(g-h)/2>0&&b>=c+(g-h)/2?"c":l+g>b?"r":"l",C=u>m||s-(m-u)/2>0&&_>=f+(m-u)/2?"c":s+m>_?"b":"t";if(_>=f+m)S="b",w=T;else if(b>=c+g)S="r",w=C;else if(s-m>=y)S="t",w=T;else if(l-g>=v)S="l",w=C;o=S+w}else S=o.charAt(0),w=o.charAt(1);var E=e.offset;if({t:1,b:1}[S])l={l:l,c:d-g/2,r:c-g}[w],s={t:s-m,b:f}[S];else if({l:1,r:1}[S])s={t:s,c:p-m/2,b:f-m}[w],l={l:l-g-E.x,r:c+E.x}[S];i.setStyles(r,{left:l+E.x+"px",top:s+E.y+"px"})}});return r});